{% extends 'base.html' %}
{% block title %}BreachPilot - AI-Assisted Penetration Testing{% endblock %}
{% block content %}

<!-- Hero Section -->
<section class="glass card rounded-xl p-8 mb-8">
  <div class="text-center">
    <div class="flex items-center justify-center gap-3 mb-4">
      <div class="flex items-center justify-center h-12 w-12 bg-indigo-600 rounded-xl">
        <svg class="h-7 w-7 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
      <h1 class="text-3xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
        BreachPilot
      </h1>
    </div>
    <p class="text-xl text-gray-300 mb-6">AI-Assisted Penetration Testing Platform</p>
    <p class="text-gray-400 max-w-2xl mx-auto">
      Automated vulnerability assessment powered by CrewAI agents and Claude AI. 
      Specializing in CVE-2020-1472 (Zerologon) detection with comprehensive AI-generated reports.
    </p>
  </div>
</section>

<!-- New Attack Chain Section -->
<section class="glass card rounded-xl p-8 mb-8">
  <div class="text-center">
    <div class="flex items-center justify-center gap-3 mb-4">
      <div class="flex items-center justify-center h-12 w-12 bg-purple-600 rounded-xl">
        <svg class="h-7 w-7 text-white" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-1 1v3a1 1 0 11-2 0V6z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <h2 class="text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
        Multi-Agent Attack Chain Orchestrator
      </h2>
    </div>
    <p class="text-gray-300 mb-6">Advanced multi-agent coordination with real-time attack chain visualization</p>
    <a href="/attack-chain" class="inline-flex items-center gap-2 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-3 rounded-lg font-medium transition">
      <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M3 6a3 3 0 013-3h10a1 1 0 01.8 1.6L14.25 8l2.55 3.4A1 1 0 0116 13H6a1 1 0 00-1 1v3a1 1 0 11-2 0V6z" clip-rule="evenodd"></path>
      </svg>
      Launch Attack Chain Orchestrator
    </a>
  </div>
</section>

<!-- Features Overview -->
<section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
  <div class="glass card rounded-xl p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="h-10 w-10 bg-indigo-600/20 rounded-lg flex items-center justify-center">
        <svg class="h-5 w-5 text-indigo-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 11-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4zm9 1a1 1 0 010-2h4a1 1 0 011 1v4a1 1 0 01-2 0V6.414l-2.293 2.293a1 1 0 11-1.414-1.414L13.586 5H12zm-9 7a1 1 0 012 0v1.586l2.293-2.293a1 1 0 111.414 1.414L6.414 15H8a1 1 0 010 2H4a1 1 0 01-1-1v-4zm13-1a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 010-2h1.586l-2.293-2.293a1 1 0 111.414-1.414L15 13.586V12a1 1 0 011-1z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <h3 class="text-lg font-semibold">Smart Reconnaissance</h3>
    </div>
    <p class="text-gray-400 text-sm">
      Advanced network scanning with AI-powered vulnerability identification focusing on Active Directory environments.
    </p>
  </div>

  <div class="glass card rounded-xl p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="h-10 w-10 bg-purple-600/20 rounded-lg flex items-center justify-center">
        <svg class="h-5 w-5 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
        </svg>
      </div>
      <h3 class="text-lg font-semibold">Multi-Agent Coordination</h3>
    </div>
    <p class="text-gray-400 text-sm">
      CrewAI-powered multi-agent system with real-time coordination and attack chain visualization.
    </p>
  </div>

  <div class="glass card rounded-xl p-6">
    <div class="flex items-center gap-3 mb-4">
      <div class="h-10 w-10 bg-green-600/20 rounded-lg flex items-center justify-center">
        <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4 2a2 2 0 00-2 2v11a3 3 0 106 0V4a2 2 0 00-2-2H4zm1 14a1 1 0 100-2 1 1 0 000 2zm5-1.757l4.9-4.9a2 2 0 000-2.828L13.485 5.1a2 2 0 00-2.828 0L10 5.757v8.486zM16 18H9.071l6-6H16a2 2 0 012 2v2a2 2 0 01-2 2z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <h3 class="text-lg font-semibold">Claude Reports</h3>
    </div>
    <p class="text-gray-400 text-sm">
      Professional penetration testing reports generated by Claude AI with executive summaries and technical details.
    </p>
  </div>
</section>

<!-- Main Test Form -->
<section class="glass card rounded-xl p-8 mb-8">
  <h2 class="text-xl font-semibold mb-6">Start Traditional Penetration Test</h2>
  
  <!-- Configuration Status -->
  {% if not (api_status.anthropic) %}
    <div class="bg-yellow-900/30 border border-yellow-400/20 rounded-lg p-4 mb-6">
      <div class="flex items-center gap-2 mb-2">
        <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
        </svg>
        <h3 class="text-sm font-semibold text-yellow-300">Configuration Required</h3>
      </div>
      <p class="text-yellow-200 text-sm mb-3">
        AI features require API key configuration. Basic scanning will work, but AI analysis and report generation will be limited.
      </p>
      <a href="/settings" class="inline-flex items-center gap-2 bg-yellow-600 hover:bg-yellow-500 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
        <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
        </svg>
        Configure API Keys
      </a>
    </div>
  {% else %}
    <div class="bg-green-900/30 border border-green-400/20 rounded-lg p-4 mb-6">
      <div class="flex items-center gap-2 mb-2">
        <svg class="h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
        </svg>
        <h3 class="text-sm font-semibold text-green-300">AI Features Ready</h3>
      </div>
      <p class="text-green-200 text-sm">
        Claude AI is configured and ready for comprehensive analysis and report generation.
      </p>
    </div>
  {% endif %}

  <form method="POST" action="/start" class="space-y-6">
    <div>
      <label class="block text-sm font-medium text-gray-300 mb-3">
        Target IP Address or Hostname
      </label>
      <div class="flex gap-4">
        <input 
          type="text" 
          name="target" 
          placeholder="192.168.1.100 or dc.example.com" 
          required
          class="flex-1 bg-slate-900/50 border border-gray-600 rounded-lg px-4 py-3 text-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
        >
        <button 
          type="submit" 
          class="bg-indigo-600 hover:bg-indigo-500 text-white px-8 py-3 rounded-lg font-medium transition flex items-center gap-2 min-w-fit"
        >
          <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd"></path>
          </svg>
          Start Test
        </button>
      </div>
      <p class="text-xs text-gray-400 mt-2">
        Enter the IP address or hostname of the target system. Ensure you have proper authorization before testing.
      </p>
    </div>

    <div class="bg-slate-800/30 rounded-lg p-4">
      <div class="flex items-start gap-3">
        <input 
          type="checkbox" 
          name="authorize" 
          id="authorize"
          class="mt-1 h-4 w-4 text-indigo-600 bg-slate-700 border-gray-600 rounded focus:ring-indigo-500"
        >
        <div class="flex-1">
          <label for="authorize" class="text-sm font-medium text-gray-300">
            I authorize controlled exploit execution (LAB ENVIRONMENT ONLY)
          </label>
          <p class="text-xs text-gray-400 mt-1">
            This enables actual PoC execution for vulnerability validation. Only enable in authorized testing environments.
          </p>
        </div>
      </div>
    </div>
  </form>
</section>

<!-- AI Pipeline Overview -->
<section class="glass card rounded-xl p-8 mb-8">
  <h2 class="text-xl font-semibold mb-6">AI-Powered Testing Pipeline</h2>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <div class="text-center">
      <div class="h-16 w-16 bg-indigo-600/20 rounded-xl mx-auto mb-4 flex items-center justify-center">
        <svg class="h-8 w-8 text-indigo-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h4a1 1 0 010 2H6.414l2.293 2.293a1 1 0 11-1.414 1.414L5 6.414V8a1 1 0 01-2 0V4z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <h3 class="font-semibold mb-2">1. Network Scan</h3>
      <p class="text-sm text-gray-400">Nmap-based port scanning with service enumeration</p>
    </div>

    <div class="text-center">
      <div class="h-16 w-16 bg-purple-600/20 rounded-xl mx-auto mb-4 flex items-center justify-center">
        <svg class="h-8 w-8 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </div>
      <h3 class="font-semibold mb-2">2. AI Analysis</h3>
      <p class="text-sm text-gray-400">CrewAI agents analyze results for vulnerabilities</p>
    </div>

    <div class="text-center">
      <div class="h-16 w-16 bg-yellow-600/20 rounded-xl mx-auto mb-4 flex items-center justify-center">
        <svg class="h-8 w-8 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
        </svg>
      </div>
      <h3 class="font-semibold mb-2">3. PoC Research</h3>
      <p class="text-sm text-gray-400">Intelligent exploit discovery from GitHub/ExploitDB</p>
    </div>

    <div class="text-center">
      <div class="h-16 w-16 bg-green-600/20 rounded-xl mx-auto mb-4 flex items-center justify-center">
        <svg class="h-8 w-8 text-green-400" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4 2a2 2 0 00-2 2v11a3 3 0 106 0V4a2 2 0 00-2-2H4z" clip-rule="evenodd"></path>
        </svg>
      </div>
      <h3 class="font-semibold mb-2">4. Claude Report</h3>
      <p class="text-sm text-gray-400">Professional report generation with executive summary</p>
    </div>
  </div>
</section>

<!-- Recent Tests (if available) -->
<section class="glass card rounded-xl p-8">
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-xl font-semibold">Recent Tests</h2>
    <a href="/settings" class="text-indigo-400 hover:text-indigo-300 text-sm flex items-center gap-1">
      <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
      </svg>
      Configure
    </a>
  </div>
  
  <div id="recent-tests">
    <div class="text-center py-12 text-gray-400">
      <svg class="h-12 w-12 mx-auto mb-4 opacity-50" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z" clip-rule="evenodd"></path>
      </svg>
      <p class="text-sm">No recent tests found</p>
      <p class="text-xs mt-1">Start a penetration test to see results here</p>
    </div>
  </div>
</section>

<!-- CVE Information -->
<section class="glass card rounded-xl p-8 mt-8">
  <h2 class="text-xl font-semibold mb-4">CVE-2020-1472 (Zerologon)</h2>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div>
      <h3 class="text-sm font-medium text-indigo-300 mb-3">Vulnerability Details</h3>
      <div class="space-y-2 text-sm">
        <div class="flex justify-between">
          <span class="text-gray-400">CVSS Score:</span>
          <span class="text-red-400 font-semibold">10.0 (Critical)</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-400">Attack Vector:</span>
          <span>Network</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-400">Authentication:</span>
          <span>None Required</span>
        </div>
        <div class="flex justify-between">
          <span class="text-gray-400">Impact:</span>
          <span>Complete DC Compromise</span>
        </div>
      </div>
    </div>
    <div>
      <h3 class="text-sm font-medium text-indigo-300 mb-3">Description</h3>
      <p class="text-sm text-gray-400 leading-relaxed">
        An elevation of privilege vulnerability exists when an attacker establishes a vulnerable 
        Netlogon secure channel connection to a domain controller, using the Netlogon Remote Protocol (MS-NRPC).
      </p>
      <div class="mt-4">
        <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-1472" target="_blank" 
           class="text-indigo-400 hover:text-indigo-300 text-xs flex items-center gap-1">
          <svg class="h-3 w-3" fill="currentColor" viewBox="0 0 20 20">
            <path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"></path>
            <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"></path>
          </svg>
          View on MITRE CVE
        </a>
      </div>
    </div>
  </div>
</section>

<script>
// Load recent tests on page load
document.addEventListener('DOMContentLoaded', function() {
  fetch('/api/jobs')
    .then(response => response.json())
    .then(data => {
      const container = document.getElementById('recent-tests');
      
      if (data.jobs && data.jobs.length > 0) {
        container.innerHTML = '';
        data.jobs.forEach(job => {
          const jobElement = document.createElement('div');
          jobElement.className = 'flex items-center justify-between p-4 bg-slate-800/30 rounded-lg mb-3 last:mb-0';
          
          const statusClass = job.status === 'completed' ? 'bg-green-900 text-green-200' : 
                             job.status === 'failed' ? 'bg-red-900 text-red-200' : 
                             'bg-yellow-900 text-yellow-200';
          
          jobElement.innerHTML = `
            <div class="flex-1">
              <div class="flex items-center gap-3">
                <span class="font-mono text-sm">${job.target}</span>
                <span class="px-2 py-1 rounded text-xs ${statusClass}">${job.status}</span>
              </div>
              <p class="text-xs text-gray-400 mt-1">
                ${job.started_at ? new Date(job.started_at * 1000).toLocaleString() : 'Unknown time'}
              </p>
            </div>
            <div class="flex gap-2">
              <a href="/status/${job.job_id}" class="text-indigo-400 hover:text-indigo-300 text-xs">View</a>
              ${job.status === 'completed' ? `<a href="/results/${job.job_id}" class="text-green-400 hover:text-green-300 text-xs">Results</a>` : ''}
            </div>
          `;
          
          container.appendChild(jobElement);
        });
      }
    })
    .catch(error => {
      console.error('Error loading recent tests:', error);
    });
});
</script>

{% endblock %}
