{% extends 'base.html' %}
{% block title %}Status - BreachPilot{% endblock %}
{% block content %}
<section class="glass card rounded-xl p-6">
  <h2 class="text-lg font-semibold mb-4">Job Status</h2>
  <p class="mb-2 text-sm"><span class="font-semibold">Job ID:</span> {{ job_id }}</p>
  <p class="mb-4 text-sm"><span class="font-semibold">Status:</span> {{ status }}{% if job and job.phase %} ({{ job.phase }}){% endif %}</p>

  <ol class="flex items-center text-xs text-gray-300 gap-2 mb-4">
    {% set steps = ['scan','poc','exploit','report'] %}
    {% for s in steps %}
      {% set done = job and (job.status=='completed' or (job.phase and steps.index(s) <= steps.index(job.phase))) %}
      <li class="flex items-center gap-2">
        <span class="h-2 w-2 rounded-full {{ 'bg-indigo-400' if done else 'bg-gray-600' }}"></span>
        <span class="uppercase tracking-wide">{{ s }}</span>
        {% if not loop.last %}<span class="mx-2 text-gray-500">â€º</span>{% endif %}
      </li>
    {% endfor %}
  </ol>

  {% if job and job.status == 'completed' %}
    <div class="space-x-3">
      <a href="/download/{{ job_id }}/md" class="bg-slate-800 border border-white/10 hover:bg-slate-700 text-white px-4 py-2 rounded">Download Markdown</a>
      <a href="/download/{{ job_id }}/pdf" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded">Download PDF</a>
    </div>
  {% elif job and job.status == 'failed' %}
    <pre class="bg-rose-900/40 border border-rose-400/20 p-3 rounded text-rose-200 text-sm">{{ job.error }}</pre>
  {% else %}
    <p class="text-sm text-gray-300">Running... refresh this page.</p>
  {% endif %}

  {% if job and job.scan %}
    <div class="mt-6">
      <h3 class="text-sm font-semibold mb-2">Scan Summary</h3>
      <div class="text-sm text-gray-300">
        <div class="mb-2"><span class="text-gray-400">Target:</span> {{ job.scan.target }}</div>
        <table class="w-full text-left text-xs border border-white/10 rounded overflow-hidden">
          <thead class="bg-slate-800/60">
            <tr>
              <th class="p-2">Port</th>
              <th class="p-2">State</th>
              <th class="p-2">Service</th>
              <th class="p-2">Product</th>
              <th class="p-2">Version</th>
            </tr>
          </thead>
          <tbody>
            {% for p in job.scan.ports %}
            <tr class="border-t border-white/10">
              <td class="p-2">{{ p.port }}</td>
              <td class="p-2">{{ p.state }}</td>
              <td class="p-2">{{ p.service or '' }}</td>
              <td class="p-2">{{ p.product or '' }}</td>
              <td class="p-2">{{ p.version or '' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% if job.scan.inferences and job.scan.inferences.possible_domain_controller %}
        <div class="mt-2 text-xs text-indigo-300">Inference: Possible Domain Controller</div>
      {% endif %}
    </div>
  {% endif %}

  {% if job and job.exploit_log_tail %}
    <div class="mt-6">
      <h3 class="text-sm font-semibold mb-2">Exploit Log (tail)</h3>
      <pre class="bg-slate-900/60 border border-white/10 p-3 rounded text-gray-200 text-xs overflow-auto max-h-56">{{ job.exploit_log_tail }}</pre>
    </div>
  {% endif %}

  <div class="mt-6">
    <a href="/" class="text-indigo-300 hover:text-indigo-200">Back</a>
  </div>
</section>
{% endblock %}


